{% extends 'base.html' %}

{% block title %}Mensagem para {{ cliente.nome }}{% endblock %}

{% block content %}
<div class="container mt-5">

    <div class="card shadow p-4 text-center">

        <h2 class="mb-3">Ol√°, {{ cliente.nome }}! üëã</h2>

        <p class="lead">
            Assine o contrato abaixo.
        </p>

        <p>
            √Årea do procedimento: {{ cliente.area }}
        </p>

    </div>

</div>
        <!-- ================= FORM POST (ASSINATURA) ================= -->
    <div class="card shadow-sm">
        <div class="card-body">

            <h4 class="mb-3">Assine abaixo:</h4>

            <form method="post">
                {% csrf_token %}

                <div class="d-flex justify-content-center mb-3">
                    <canvas id="pad" width="400" height="200" class="border border-2 rounded"></canvas>
                </div>

                <div class="d-flex gap-2 justify-content-center mb-3">
                    <button type="button" class="btn btn-secondary" onclick="limpar()">Limpar</button>
                    <button type="button" class="btn btn-success" onclick="salvar()">Salvar Assinatura</button>
                </div>

                <input type="hidden" name="imagem" id="imagem">
            </form>

        </div>
    </div>

</div>

<script>
let canvas = document.getElementById('pad');
let ctx = canvas.getContext('2d');
let desenhando = false;

canvas.addEventListener('mousedown', () => desenhando = true);
canvas.addEventListener('mouseup', () => {
    desenhando = false;
    ctx.beginPath();
});
canvas.addEventListener('mousemove', desenhar);

function desenhar(e) {
    if (!desenhando) return;
    ctx.lineWidth = 2;
    ctx.lineCap = "round";
    ctx.strokeStyle = "#000";
    ctx.lineTo(e.offsetX, e.offsetY);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(e.offsetX, e.offsetY);
}

function limpar() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
}

function salvar() {
    let dataURL = canvas.toDataURL("image/png");
    document.getElementById("imagem").value = dataURL;
    document.forms[1].submit();
}
</script>
{% endblock %}
